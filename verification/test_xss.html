
    <!DOCTYPE html>
    <html>
    <head>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <style>
            .aips-score-high { background: green; color: white; }
            .aips-score-medium { background: orange; }
            .aips-score-low { background: gray; color: white; }
        </style>
    </head>
    <body>
        <div id="topics-container"></div>
        <div id="research-results" style="display:none;">
            <div id="research-results-content"></div>
        </div>
        <div id="bulk-schedule-section" style="display:none;"></div>

        <!-- Elements needed for the script to attach events -->
        <button id="load-topics">Load Topics</button>
        <input id="filter-niche" value="">
        <input id="filter-score" value="">
        <input type="checkbox" id="filter-fresh">
        <input type="hidden" id="aips_nonce" value="test_nonce">

        <script>
            var ajaxurl = '/wp-admin/admin-ajax.php';

jQuery(document).ready(function($) {
    let selectedTopics = [];

    // Security helper
    function escapeHtml(text) {
        if (!text) return '';
        return $('<div>').text(text).html();
    }

    // Research form submission
    $('#aips-research-form').on('submit', function(e) {
        e.preventDefault();

        const $form = $(this);
        const $submit = $('#research-submit');
        const $spinner = $form.find('.spinner');

        const niche = $('#research-niche').val();
        const count = $('#research-count').val();
        const keywordsStr = $('#research-keywords').val();
        const keywords = keywordsStr ? keywordsStr.split(',').map(k => k.trim()) : [];

        $submit.prop('disabled', true).addClass('is-loading');
        $spinner.addClass('is-active');

        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'aips_research_topics',
                nonce: $('#aips_nonce').val(),
                niche: niche,
                count: count,
                keywords: keywords
            },
            success: function(response) {
                if (response.success) {
                    displayResearchResults(response.data);
                    $('#load-topics').trigger('click'); // Refresh topics list
                } else {
                    alert('Error: ' + response.data.message);
                }
            },
            error: function() {
                alert('""');
            },
            complete: function() {
                $submit.prop('disabled', false).removeClass('is-loading');
                $spinner.removeClass('is-active');
            }
        });
    });

    // Display research results
    function displayResearchResults(data) {
        const $container = $('#research-results-content');
        let html = '<p><strong>' + escapeHtml(data.saved_count) + ' "" "' + escapeHtml(data.niche) + '"</strong></p>';

        if (data.top_topics && data.top_topics.length > 0) {
            html += '<h4>""</h4><ol>';
            data.top_topics.forEach(function(topic) {
                const scoreClass = topic.score >= 90 ? 'high' : (topic.score >= 70 ? 'medium' : 'low');
                html += '<li><strong>' + escapeHtml(topic.topic) + '</strong> ';
                html += '<span class="aips-score-badge aips-score-' + scoreClass + '">' + escapeHtml(topic.score) + '</span>';
                if (topic.reason) {
                    html += '<br><small><em>' + escapeHtml(topic.reason) + '</em></small>';
                }
                html += '</li>';
            });
            html += '</ol>';
        }

        $container.html(html);
        $('#research-results').slideDown();
    }

    // Load topics
    $('#load-topics').on('click', function() {
        const niche = $('#filter-niche').val();
        const minScore = $('#filter-score').val();
        const freshOnly = $('#filter-fresh').is(':checked');

        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'aips_get_trending_topics',
                nonce: $('#aips_nonce').val(),
                niche: niche,
                min_score: minScore,
                fresh_only: freshOnly,
                limit: 50
            },
            success: function(response) {
                if (response.success) {
                    displayTopicsTable(response.data.topics);
                } else {
                    alert('Error: ' + response.data.message);
                }
            }
        });
    });

    // Display topics table
    function displayTopicsTable(topics) {
        if (!topics || topics.length === 0) {
            $('#topics-container').html('<p>""</p>');
            return;
        }

        let html = '<table class="aips-topics-table">';
        html += '<thead><tr>';
        html += '<th><input type="checkbox" id="select-all-topics"></th>';
        html += '<th>""</th>';
        html += '<th>""</th>';
        html += '<th>""</th>';
        html += '<th>""</th>';
        html += '<th>""</th>';
        html += '<th>""</th>';
        html += '</tr></thead><tbody>';

        topics.forEach(function(topic) {
            const scoreClass = topic.score >= 90 ? 'high' : (topic.score >= 70 ? 'medium' : 'low');
            const keywords = Array.isArray(topic.keywords) ? topic.keywords : [];

            html += '<tr>';
            html += '<td><input type="checkbox" class="topic-checkbox" value="' + escapeHtml(topic.id) + '"></td>';
            html += '<td><strong>' + escapeHtml(topic.topic) + '</strong>';
            if (topic.reason) {
                html += '<br><small>' + escapeHtml(topic.reason) + '</small>';
            }
            html += '</td>';
            html += '<td><span class="aips-score-badge aips-score-' + scoreClass + '">' + escapeHtml(topic.score) + '</span></td>';
            html += '<td>' + escapeHtml(topic.niche) + '</td>';
            html += '<td><div class="aips-keywords-list">';
            keywords.forEach(function(kw) {
                html += '<span class="aips-keyword-tag">' + escapeHtml(kw) + '</span>';
            });
            html += '</div></td>';
            html += '<td>' + new Date(topic.researched_at).toLocaleDateString() + '</td>';
            html += '<td><div class="aips-topic-actions">';
            html += '<button class="button button-small delete-topic" data-id="' + escapeHtml(topic.id) + '">""</button>';
            html += '</div></td>';
            html += '</tr>';
        });

        html += '</tbody></table>';
        $('#topics-container').html(html);

        // Show bulk schedule section
        $('#bulk-schedule-section').show();
    }

    // Select all topics
    $(document).on('change', '#select-all-topics', function() {
        $('.topic-checkbox').prop('checked', $(this).is(':checked'));
        updateSelectedTopics();
    });

    // Individual checkbox change
    $(document).on('change', '.topic-checkbox', function() {
        updateSelectedTopics();
    });

    // Update selected topics
    function updateSelectedTopics() {
        selectedTopics = $('.topic-checkbox:checked').map(function() {
            return $(this).val();
        }).get();
    }

    // Delete topic
    $(document).on('click', '.delete-topic', function() {
        if (!confirm('""')) {
            return;
        }

        const topicId = $(this).data('id');

        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'aips_delete_trending_topic',
                nonce: $('#aips_nonce').val(),
                topic_id: topicId
            },
            success: function(response) {
                if (response.success) {
                    $('#load-topics').trigger('click');
                } else {
                    alert('Error: ' + response.data.message);
                }
            }
        });
    });

    // Bulk schedule
    $('#bulk-schedule-form').on('submit', function(e) {
        e.preventDefault();

        if (selectedTopics.length === 0) {
            alert('""');
            return;
        }

        const $form = $(this);
        const $submit = $form.find('button[type="submit"]');
        const $spinner = $form.find('.spinner');

        $submit.prop('disabled', true).addClass('is-loading');
        $spinner.addClass('is-active');

        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'aips_schedule_trending_topics',
                nonce: $('#aips_nonce').val(),
                topic_ids: selectedTopics,
                template_id: $('#schedule-template').val(),
                start_date: $('#schedule-start-date').val(),
                frequency: $('#schedule-frequency').val()
            },
            success: function(response) {
                if (response.success) {
                    alert(response.data.message);
                    selectedTopics = [];
                    $('.topic-checkbox').prop('checked', false);
                    $('#select-all-topics').prop('checked', false);
                } else {
                    alert('Error: ' + response.data.message);
                }
            },
            error: function() {
                alert('""');
            },
            complete: function() {
                $submit.prop('disabled', false).removeClass('is-loading');
                $spinner.removeClass('is-active');
            }
        });
    });

    // Auto-load topics on page load
    $('#load-topics').trigger('click');
});

        </script>
    </body>
    </html>
