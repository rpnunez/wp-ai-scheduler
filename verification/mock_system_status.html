
    <!DOCTYPE html>
    <html>
    <head>
        <title>System Status Mock</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dashicons/1.0.0/css/dashicons.min.css">
        <style>
            body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif; background: #f1f1f1; }
            .card { background: #fff; border: 1px solid #ccd0d4; float: left; margin: 20px; max-width: 320px; padding: 20px; box-sizing: border-box; }
            .notice { background: #fff; border-left: 4px solid #fff; box-shadow: 0 1px 1px 0 rgba(0,0,0,.1); margin: 5px 15px 2px; padding: 1px 12px; }
            .notice-success { border-left-color: #46b450; }
            .button { display: inline-block; text-decoration: none; font-size: 13px; line-height: 2.15384615; min-height: 30px; margin: 0; padding: 0 10px; cursor: pointer; border-width: 1px; border-style: solid; -webkit-appearance: none; border-radius: 3px; white-space: nowrap; box-sizing: border-box; }
            .button-primary { background: #2271b1; border-color: #2271b1; color: #fff; }
            .button-secondary { color: #2271b1; border-color: #2271b1; background: #f6f7f7; vertical-align: top; }
            hr { border: 0; border-top: 1px solid #ddd; border-bottom: 1px solid #fafafa; }
        </style>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    </head>
    <body>
    <h2 class="title">Database Actions</h2>
        <div class="card">
            <h3>Repair & Maintenance</h3>
            <p>Use these tools to fix database issues or reset the plugin.</p>

            <p>
                <button type="button" class="button button-primary aips-repair-db">Repair DB Tables</button>
                <span class="description">Runs the database migration script to fix missing tables or columns.</span>
            </p>

            <hr>

            <p>
                <label>
                    <input type="checkbox" id="aips-backup-db">
                    Backup and Restore Data (Experimental)
                </label>
            </p>
            <p>
                <button type="button" class="button button-secondary aips-reinstall-db">Reinstall DB Tables</button>
                <span class="description">Drops and recreates all plugin tables. Use with caution.</span>
            </p>

            <hr>

            <p>
                <button type="button" class="button button-link-delete aips-wipe-db">Wipe Plugin Data</button>
                <span class="description">Permanently deletes all data from the plugin tables.</span>
            </p>
        </div>

        <div class="card">
            <h3>Data Management</h3>
            <p>Export and Import plugin data.</p>

            <hr>

            <h4>Export Data</h4>
            <form method="post" action="mock_admin_post.php">
                <input type="hidden" name="action" value="aips_export_data">
                <input type="hidden" name="nonce" value="mock">
                <p>
                    <select name="format">
                        <option value="mysql">MySQL Dump (.sql)</option>
                        <option value="json">JSON</option>
                    </select>
                </p>
                <p>
                    <button type="submit" class="button button-secondary">Export Data</button>
                </p>
            </form>

            <hr>

            <h4>Import Data</h4>
            <form method="post" action="mock_admin_post.php" enctype="multipart/form-data" class="aips-import-form">
                <input type="hidden" name="action" value="aips_import_data">
                <input type="hidden" name="nonce" value="mock">
                <p>
                    <input type="file" name="import_file" accept=".sql,.json">
                </p>
                <p>
                    <select name="format">
                        <option value="mysql">MySQL Dump (.sql)</option>
                        <option value="json">JSON</option>
                    </select>
                </p>
                <p>
                    <button type="submit" class="button button-primary aips-import-data-btn">Import Data</button>
                </p>
            </form>
        </div>
    </div>
</div>

<script>
jQuery(document).ready(function($) {
    $('.aips-toggle-log-details').on('click', function(e) {
        e.preventDefault();
        var target = $(this).data('target');
        $('#' + target).toggle();
    });
});
</script>

    <script>
    var aipsAjax = { ajaxUrl: 'mock_ajax.php', nonce: 'mock_nonce' };
    </script>
    <script>
    (function($) {
    'use strict';

    // Ensure AIPS object exists
    window.AIPS = window.AIPS || {};

    // Extend AIPS with DB Management functionality
    Object.assign(window.AIPS, {

        repairDb: function(e) {
            e.preventDefault();
            var $btn = $(this);
            if (!confirm('Are you sure you want to run the database repair? This will attempt to create missing tables and columns.')) {
                return;
            }

            $btn.prop('disabled', true).text('Repairing...');

            $.ajax({
                url: aipsAjax.ajaxUrl,
                type: 'POST',
                data: {
                    action: 'aips_repair_db',
                    nonce: aipsAjax.nonce
                },
                success: function(response) {
                    if (response.success) {
                        alert(response.data.message);
                        location.reload();
                    } else {
                        alert(response.data.message);
                    }
                },
                error: function() {
                    alert('An error occurred.');
                },
                complete: function() {
                    $btn.prop('disabled', false).text('Repair DB Tables');
                }
            });
        },

        reinstallDb: function(e) {
            e.preventDefault();
            var $btn = $(this);
            var backup = $('#aips-backup-db').is(':checked');
            var msg = 'Are you sure you want to reinstall the database tables?';
            if (!backup) {
                msg += '\n\nWARNING: ALL DATA WILL BE LOST unless you check the backup option!';
            } else {
                msg += '\n\nData will be backed up and restored.';
            }

            if (!confirm(msg)) {
                return;
            }

            $btn.prop('disabled', true).text('Reinstalling...');

            $.ajax({
                url: aipsAjax.ajaxUrl,
                type: 'POST',
                data: {
                    action: 'aips_reinstall_db',
                    nonce: aipsAjax.nonce,
                    backup: backup
                },
                success: function(response) {
                    if (response.success) {
                        alert(response.data.message);
                        location.reload();
                    } else {
                        alert(response.data.message);
                    }
                },
                error: function() {
                    alert('An error occurred.');
                },
                complete: function() {
                    $btn.prop('disabled', false).text('Reinstall DB Tables');
                }
            });
        },

        wipeDb: function(e) {
            e.preventDefault();
            var $btn = $(this);
            if (!confirm('Are you sure you want to WIPE ALL DATA? This cannot be undone.')) {
                return;
            }

            $btn.prop('disabled', true).text('Wiping...');

            $.ajax({
                url: aipsAjax.ajaxUrl,
                type: 'POST',
                data: {
                    action: 'aips_wipe_db',
                    nonce: aipsAjax.nonce
                },
                success: function(response) {
                    if (response.success) {
                        alert(response.data.message);
                        location.reload();
                    } else {
                        alert(response.data.message);
                    }
                },
                error: function() {
                    alert('An error occurred.');
                },
                complete: function() {
                    $btn.prop('disabled', false).text('Wipe Plugin Data');
                }
            });
        },

        importData: function(e) {
            var $btn = $(this);
            var $form = $btn.closest('form');
            var fileInput = $form.find('input[name="import_file"]');

            if (fileInput.val() === '') {
                alert('Please select a file to import.');
                e.preventDefault();
                return;
            }

            if (!confirm('Have you made a backup? This action is irreversible and will overwrite existing data.\n\nAre you sure you want to proceed?')) {
                e.preventDefault();
            }
        }
    });

    // Bind DB Management Events
    $(document).ready(function() {
        $(document).on('click', '.aips-repair-db', window.AIPS.repairDb);
        $(document).on('click', '.aips-reinstall-db', window.AIPS.reinstallDb);
        $(document).on('click', '.aips-wipe-db', window.AIPS.wipeDb);
        $(document).on('click', '.aips-import-data-btn', window.AIPS.importData);
    });

})(jQuery);

    </script>
    </body>
    </html>
